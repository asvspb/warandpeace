# Снижение шума логов в задаче проверки новостей (JobQueue)

Цель: убрать повторяющиеся «пустые» сообщения каждые 5 минут и оставить в логах только полезные сигналы — когда появились новые статьи и что именно было опубликовано.

## Текущее поведение
Каждые 5 минут задача пишет на уровне INFO:
- "[TASK] Запущена задача проверки и публикации новостей..."
- "[TASK] Новых статей для публикации не найдено."

Это создает шум при штатной работе, когда новостей нет.

## Желаемое поведение
- Сообщения об очередном запуске и об отсутствии новостей — не должны засорять INFO. Перенести их в DEBUG (или отключать через флаг окружения).
- На уровне INFO оставлять только факты полезной деятельности:
  - Найдены новые статьи (название, URL, таймстемп).
  - Количество обработанных/опубликованных записей за запуск.
  - Сводное сообщение по результатам запуска, если были публикации.

## План изменений
1) Понизить уровень «сердцебиений» задачи до DEBUG
- Строки:
  - logger.info("[TASK] Запущена задача...") → logger.debug("...")
  - logger.info("[TASK] Новых статей...") → logger.debug("...")
- Опционально: ввести флаг `LOG_TASK_HEARTBEAT` (по умолчанию false). Если выставлен, оставлять их на INFO — для временной диагностики.

2) Добавить информативные логи только при наличии работы
- Когда парсер вернул кандидаты и среди них есть новые к публикации:
  - Логировать на INFO: список найденных новых статей (заголовок + ссылка, не более N=5 в лог, остальное — счетчиком `(+K скрыто)`), чтобы не раздувать логи.
  - В конце запуска — сводка: `posted_count`, общее число кандидатов, длительность выполнения.

3) Свести формат логов к компактному и «сканируемому»
- Пример сообщений на INFO:
  - `Найдены новые статьи: 2 шт. Примеры: ["Заголовок 1" https://...], ["Заголовок 2" https://...]`
  - `Публикация завершена: опубликовано=2; кандидатов=7; длительность=9.2с`
- Уровень DEBUG — подробности (детали отбора/фильтрации, пропуски и причины).

4) Переменные окружения (опционально)
- `LOG_TASK_HEARTBEAT=false` — включить/выключить пустые «сердцебиения» на INFO.
- `LOG_POST_EXAMPLES=5` — лимит примеров новых статей, которые попадают в INFO.

5) Изменения в коде (точечно)
- В `src/bot.py` внутри `check_and_post_news`:
  - Перевести «запуск задачи» и «нет новостей» на DEBUG или на INFO под флагом `LOG_TASK_HEARTBEAT`.
  - Перед циклом публикации собрать список `new_articles = [...]` (те, которых нет в БД) и, если он непуст, сделать один INFO-лог со сводкой и ограниченным списком примеров.
  - После цикла — итоговый INFO-лог, если `posted_count > 0`.
  - Существующие логи "Найдена новая статья для обработки: ..." можно оставить на INFO, либо перевести на DEBUG (если будет предварительная сводка). Рекомендуется оставить на INFO, но за счет предварительного списка можно понизить уровень этого сообщения до DEBUG для уменьшения повторов.

6) Тест-план
- Ручная проверка:
  - При отсутствии новостей: в течение нескольких интервалов в INFO ничего не появляется, только DEBUG при включенном уровне.
  - При появлении новостей: в INFO ровно два сообщения — предварительная сводка и итоговая сводка (плюс, по выбору, сообщения на событие публикации).
- Автотесты (минимум):
  - Юнит-тест формирования сводной строки (ограничение примеров, счетчик «скрыто»).
  - Тест логического ветвления: при `LOG_TASK_HEARTBEAT=true` сообщения попадают в INFO, иначе — в DEBUG.

## Откат
- Поменять уровень логирования обратно (DEBUG → INFO) или удалить флаг `LOG_TASK_HEARTBEAT` — поведение вернется к исходному без влияния на бизнес-логику.

## Примечания
- Сохранить текущие механизмы уведомлений об ошибках и троттлинг — они не влияют на шум в штатной ситуации.
- Не менять интервал JobQueue. Вся оптимизация — только на уровне логов.
