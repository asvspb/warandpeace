## План фоновой синхронизации архива и дашборда

Цель: периодически синхронизировать архив сайта (исторические страницы) и отображать прогресс/состояние на веб-дашборде.

### 1) Архитектура
- Планировщик: существующий JobQueue (бот) + отдельный CLI (`scripts/manage.py`) для on-demand.
- Хранилище: таблицы `articles` (content, content_hash) + служебная таблица `sync_runs`.
- Веб: новые страницы `/admin/sync` (статусы, прогресс, последние ошибки).

### 2) Модель данных
- `sync_runs(id, started_at, finished_at, status: running|success|failed, total, processed, errors)`.
- Логи ошибок — в DLQ (entity_type='archive_sync').

### 3) Реализация
- [ ] CLI команды: `ingest-page`, `backfill-range`, `reconcile` (есть) — собрать в `sync:run` с параметрами.
- [ ] Фоновая задача `run_repeating` для периодической сверки (напр., каждые 6 часов).
- [ ] Веб-страницы и сервисы: чтение `sync_runs`, DLQ, отображение прогресса/ошибок.
- [ ] Метрики: gauges (последний успешный sync, длительность, скорость).

### 4) Дизайн дашборда
- Карточки: Последний успешный запуск, всего добавлено, ошибок, возраст последней статьи.
- Таблица последних `sync_runs` + ссылка на DLQ.

### 5) Тест-план
- Юнит: расчёт прогресса, запись статуса, DLQ на ошибках.
- Интеграция: прогон `sync:run` на тестовом архиве.
- Веб: ручные тесты UI.

### 6) Риски
- Rate limit/блокировки — задержки/джиттер, троттлинг.
- Изменения верстки — DLQ с полезной диагностикой.