## План резервного копирования в облако

Цель: автоматизировать бэкапы БД и важного состояния в облачное хранилище.

### 1) Объекты бэкапа
- БД (SQLite → объект файла; Postgres → `pg_dump`/basebackup).
- Конфигурация `.env` (без секретов в git), артефакты (планы, миграции).

### 2) Хранилище
- S3-совместимое (Backblaze B2/Wasabi/MinIO): bucket `warandpeace-backups`.
- Шифрование: SSE-S3 или клиентское через `openssl age`/`sops`.

### 3) Процедуры
- [ ] Скрипт `tools/backup.py`: создаёт дамп, архивирует, шифрует (опц.), загружает в S3, проставляет метаданные.
- [ ] Политика ротации: дневные (7), недельные (4), месячные (6).
- [ ] Восстановление: `tools/restore.py` (проверка контрольных сумм).
- [ ] Healthcheck: метрика/лог об успешном бэкапе.

### 4) Инфраструктура
- Переменные окружения: `S3_ENDPOINT`, `S3_BUCKET`, `S3_ACCESS_KEY`, `S3_SECRET_KEY`, `S3_REGION`.
- Docker cron/systemd timer в хосте.

### 5) Тест-план
- Тестовый бэкап/восстановление на stage БД.
- Инъекция ошибки сети → повторная попытка.

### 6) Риски
- Утечка секретов — только переменные окружения/секрет-хранилище.
- Неполные бэкапы — валидировать размер/хэши.