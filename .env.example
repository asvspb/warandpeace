# War & Peace — .env.example
# Заполните секреты и при необходимости измените дефолты.
# Формат: KEY=value (без кавычек).

# --- Основное/БД ---
DB_SQLITE_PATH=/app/database/articles.db
TIMEZONE=Europe/Moscow

# --- Telegram ---
TELEGRAM_BOT_TOKEN=changeme
TELEGRAM_CHANNEL_ID=123456789
TELEGRAM_ADMIN_ID=123456789
# TELEGRAM_ADMIN_IDS=123456789,987654321

# --- LLM и модели ---
LLM_PRIMARY=gemini                 # gemini|mistral
GEMINI_ENABLED=true                # true|false|1|0|yes|no
MISTRAL_ENABLED=true               # true|false|1|0|yes|no
# Рекомендуется указывать список ключей через запятую:
GOOGLE_API_KEYS=
# Для обратной совместимости можно также задать одиночные ключи:
# GOOGLE_API_KEY=
# GOOGLE_API_KEY_1=

MISTRAL_API_KEY=
GEMINI_MODEL_NAME=models/gemini-1.5-flash-latest
MISTRAL_MODEL_NAME=mistral-large-latest

# --- Директории шаблонов промптов ---
PROMPTS_DIR=prompts

# --- Служебные промпты (без ротации) ---
# Включить служебные JSON-промпты (параллельно с публичными). Используются фиксированные шаблоны v1
SERVICE_PROMPTS_ENABLED=true

# --- Telegram канал для служебных прогнозов ---
# Включить отправку кратких прогнозов (служебных) в отдельный канал
SERVICE_TG_ENABLED=false
# ID канала или @username для публикации служебных прогнозов
SERVICE_TG_CHANNEL_ID=

# --- Веб-интерфейс ---
WEB_ENABLED=false                  # включить сервер (uvicorn) при запуске server.py напрямую
WEB_HOST=0.0.0.0
WEB_PORT=8080
WEB_API_ENABLED=false              # включить API-роуты
# Если нужно защищать API по ключу — задайте ключ. Проверяется в заголовке X-API-Key
# или Authorization: Api-Key <ключ> только для маршрутов /api при WEB_API_ENABLED=true.
WEB_API_KEY=
# Для бота: URL веб-сервиса статуса (бот умеет автообнаруживать, но лучше указать явно)
BACKFILL_STATUS_URL=http://web:8080
# Если API защищён ключом — передайте тот же ключ сюда
BACKFILL_API_KEY=
# Режим аутентификации веб-интерфейса: basic|webauthn (webauthn потребует сессии и ключи)
WEB_AUTH_MODE=basic
# Секрет для сессий веб-интерфейса (обязательно установите в проде)
WEB_SESSION_SECRET=change-me-please
# WebAuthn RP (домен админки) и отображаемое имя
WEB_RP_ID=admin.example.com
WEB_RP_NAME=War & Peace Admin

# --- TLS/прокси (Caddy) ---
# Домен и email для автоматического TLS через Caddy (Let's Encrypt)
CADDY_DOMAIN=admin.example.com
CADDY_EMAIL=you@example.com
# Для Basic Auth укажите оба значения:
# WEB_BASIC_AUTH_USER=admin
# WEB_BASIC_AUTH_PASSWORD=strongpass

# --- Автообновление и авто-суммаризация ---
# Режимы: auto|manual. При auto воркеры запускаются на старте веб-приложения.
BASE_AUTO_UPDATE=manual
BASE_AUTO_UPDATE_DATE_TARGET=01.01.2025
BASE_AUTO_SUM=manual
BASE_AUTO_SUM_MODEL=gemini

# --- Метрики ---
METRICS_ENABLED=true
METRICS_PORT=8000

# --- Логи и таймауты Telegram ---
LOG_LEVEL=INFO
ENABLE_VERBOSE_LIB_LOGS=false
ADMIN_ALERTS_COOLDOWN_SEC=900      # троттлинг повторных админ-уведомлений (секунды)
TG_RETRY_ATTEMPTS=4
LOG_POST_EXAMPLES=3
MAX_POSTS_PER_RUN=3
JOB_MISFIRE_GRACE=60
JOB_JITTER=3
TG_READ_TIMEOUT=60
TG_WRITE_TIMEOUT=60
TG_CONNECT_TIMEOUT=30
TG_POOL_TIMEOUT=60
TG_HTTP_VERSION=1.1
TG_POLL_INTERVAL=1.0
TG_LONG_POLL_TIMEOUT=10

# --- Circuit Breaker / сеть ---
TG_CB_FAILURE_THRESHOLD=5
TG_CB_FAILURE_WINDOW_SEC=60
TG_CB_OPEN_COOLDOWN_SEC=30
NET_LOG_THROTTLE_SEC=900

# --- Бэкапы / восстановление ---
LOCAL_BACKUP_DIR=/var/backups/warandpeace
BACKUP_TMP_DIR=/tmp/backup
BACKUP_RETENTION_DAYS=0           # дней хранения бэкапов (0 — отключено)
LOCAL_MIN_FREE_GB=0               # мин. свободное место в ГБ (0 — проверка отключена)
# Шифрование age:
# AGE_PUBLIC_KEYS=age1xxxx,age1yyyy
# AGE_SECRET_KEY=AGE-SECRET-KEY-xxxxxxxx

# --- Прочее для утилит ---
APP_DIR=/app                      # путь, где лежит .env (используется в backup env)
